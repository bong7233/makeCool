<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.4.2/gsap.min.js "></script>
    <title>test</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Poppins&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../static/css/style.css" />
    <script defer src="../static/js/listing.js"></script>
    <script defer src="../static/js/main.js"></script>
    <script defer src="../static/js/detailBox.js"></script>
    <style>
      .comment-icon {
        margin: 0 10px;
      }

      .write-comment {
        display: none;
        position: relative;
        height: 100px;
      }

      .write-comment > textarea {
        position: relative;
        width: 100%;
        padding-right: 50px;
        height: 100px;
        border-radius: 5px;
      }

      .write-comment > button {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        border: 0px solid #000;
        border-radius: 30px;
        background-color: #dc6161;
        color: #fefefe;
        display: flex;
        align-items: center;
      }

      .comment-list {
        width: 100%;
      }

      .comm-one > p {
        margin-left: 10px;
      }

      .comm-one {
        position: relative;
        margin: 0 auto;
      }

      .comm-one > i {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
      }

      #heart {
        color: red;
      }
    </style>
    <script>

      let user_info = {{ user_info| tojson}};
      let bu_clicked

      function isliked() {
          let n = document.getElementById('heart')

          if (user_info['like'].includes(videoid)) {
              n.setAttribute('class', 'fas fa-heart')
          } else {
              n.setAttribute('class', 'far fa-heart')
          }
      }


      ///random token generator

      var rand = function () {
          return Math.random().toString(36).substr(2); // remove `0.`
      };

      var token = function () {
          return rand() + rand(); // to make it longer
      };


      function writeComment() {
          let display = document.getElementById("comment-box");
          if (display.style.display == '') {
              display.style.display = "block"
          } else {
              display.style.display = ''
          }


      }

      function postComment() {

          $.ajax({

              type: "POST",
              url: `/api/post_comment`,
              data: {
                  id_give: user_info['id'],
                  user_give: user_info['name'],
                  comment_give: $('textarea#msg').val(),
                  comment_id_give: token(),
                  video_id_give: videoid,

              },
              success: function (response) {
                  alert(response["msg"])
              }
          });
          getComment()

      }
      let isRun = false;
      function getComment() {
        if(isRun == true) { return; } isRun = true;
          $('#comment-list').empty()
          $.ajax({
              type: "GET",
              url: `/api/get_comment?video_id_give=${videoid}`,
              data: {},
              success: function (response) {
                  comment_list = response["comment"]
                  for (let i = 0; i < comment_list.length; i++) {
                      let comment = comment_list[i]
                      let id = comment['id']
                      let user = comment['name']
                      let com = comment["comment"]
                      let com_id = comment['comment_id']
                      html_temp = `<div class="comm-one" com_id =${com_id}>
                      <span>${user}</span>
                      <p>${com}</p>
                      <i  onclick= 'deleteComment(this)' class="fas fa-trash-alt trash-icon" id='trash-icon'></i>
                      </div>`
                      $('#comment-list').append(html_temp)
                      isRun  = false;
                  }
              }
          });
      }

      function getLike() {

          $.ajax({
              type: "GET",
              url: `/api/get_like?video_id_give=${videoid}&user_id_give=${user_info['id']}`,
              data: {},
              success: function (response) {
                  let num = document.getElementById("heart-count");
                  let heart = document.getElementById("heart")
                  num.innerHTML = response['count']
                  response['isliked'] ==true ? heart.setAttribute('class', "fas fa-heart"): heart.setAttribute('class', "far fa-heart")

              }
          });
      }

      function deleteComment(event) {
          let node = event
          let parent = node.parentElement
          let com_id = parent.getAttribute('com_id')


          $.ajax({

              type: "POST",
              url: `/api/delete_comment`,
              data: {
                  "comment_id_give": com_id,
                  "user_name_give": user_info['name'],
                  "video_id_give": videoid
              },
              success: function (response) {
                  alert(response["msg"])
              }
          })
          getComment()
      }

      function addLike() {
          $.ajax({
              type: "POST",
              url: `/api/add_like`,
              data: {
                  id_give: user_info['id'],
                  video_id_give: videoid
              },
              success: function (response) {
                  let num = document.getElementById("heart-count");
                  let count = response['count']
                  num.innerHTML = '' + count;

              }
          });
      }


      function undoLike() {

          $.ajax({
              type: "POST",
              url: `/api/undo_like`,
              data: {
                  id_give: user_info['id'],
                  video_id_give: videoid
              },
              success: function (response) {
                  let num = document.getElementById("heart-count");
                  let count = response['count']
                  num.innerHTML = '' + count;

              }
          });
      }


      function addFavorite() {

      }

      function deleteFavorite() {

      }

      function heartColor(event) {
          let node = event

          //좋아요가 이미 눌려있는경우
          if (node.getAttribute('class') == 'fas fa-heart') {
              node.setAttribute('class', "far fa-heart")
              undoLike()
              //좋아요가 안눌려 있는 경우
          } else {
              node.setAttribute('class', "fas fa-heart")
              addLike()

          }
      }
    </script>
  </head>
  <body>
    <div class="backImg"></div>
    <header>
      <section>
        <div class="headerLogo">
          <a href=""><img src="../static/images/logo.png" /></a>
        </div>
        <div class="headerInfo">
          <div class="infoBox"></div>
        </div>
      </section>
    </header>
    <div class="detailBox">
      <div id="profile_container">
        <div id="profile_box2"></div>
        <div class="nickName">
          <span>{{ name }}님</span>
        </div>
      </div>
      <div id="edit_container">
        <div class="editPassword">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          <a href="/api/information"><span>회원정보수정</span></a>
        </div>
        <div class="editFavorite">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
            />
          </svg>
          <a href="/favorite"><span>즐겨찾기</span></a>
        </div>
        <div class="editLogout">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
            />
          </svg>
          <div class="logoutBtn">
            <a id="logout"><span>로그아웃</span></a>
          </div>
        </div>
      </div>
    </div>

    <!-- 김지호 수정 -->
    <div class="listingContainer">
      <button data-genre="neck" class="listingBox_neck listing_genres">
        <div>neck</div>
      </button>
      <button data-genre="waist" class="listingBox_waist listing_genres">
        <div>waist</div>
      </button>
      <button data-genre="wrist" class="listingBox_wrist listing_genres">
        <div>wrist</div>
      </button>
      <button
        data-genre="lowerBody"
        class="listingBox_lowerBody listing_genres"
      >
        <div>lowerBody</div>
      </button>
    </div>

    <!-- /김지호 수정 /-->
    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      db=""
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="col">
              <div class="card shadow-sm">
                <iframe
                  class="modal-video"
                  width="100%"
                  height="400px"
                  src=""
                  title="YouTube video player"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                ></iframe>
              </div>
              <div>
                <h2 class="modal-title"></h2>
                <div class="d-flex justify-content-start align-items-center">
                  <div class="like" id="like">
                    <i
                      onclick="heartColor(this)"
                      id="heart"
                      class="far fa-heart"
                    ></i>
                    <span id="heart-count">0</span>
                  </div>
                  <div class="comment-icon">
                    <i
                      class="fas fa-pen"
                      id="comment"
                      onclick="writeComment()"
                    ></i>
                  </div>
                </div>
                <hr />
                <h5 class="modal-desc"></h5>
                <hr />
                <div class="comment-box">
                  <div class="write-comment" id="comment-box">
                    <textarea name="msg" id="msg" cols="40" rows="4"></textarea>
                    <button onclick="postComment()">submit</button>
                  </div>
                  <div class="comment-list" id="comment-list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- // Modal -->
    <!-- Thumbnail -->
    <main>
      <div class="album py-5">
        <div class="container clearFix">
          <div
            id="thumbnail-box"
            class="row row-cols-5 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3"
          ></div>
        </div>
      </div>
    </main>
    <!-- // Thumbnail -->
    <!--footer-->
    <footer>
      <div class="footer_overview">
        고객센터(이용 및 결제 문의) charley@watcha.co.kr • 02-000-0000 (유료)
        <br />
        Copyright © 2022 Corp. All rights reserved by hanghe99_0WeekTeam
      </div>
    </footer>
  </body>
</html>
